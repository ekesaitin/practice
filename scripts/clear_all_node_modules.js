const fs = require('fs/promises')
const path = require('path')

async function rmModule(dir) {
  const files = await fs.readdir(dir)
  for (const file of files) {
    const filePath = path.resolve(dir, file)
    const stat = await fs.stat(filePath)
    if (stat.isDirectory()) {
      if (file === 'node_modules') {
        console.log('rm -rf', filePath)
        fs.rm(filePath, { recursive: true })
      } else {
        await rmModule(filePath)
      }
    }
  }
}

const root = path.resolve(__dirname, '..')
rmModule(root)